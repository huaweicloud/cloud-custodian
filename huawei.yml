# policies:
#       - name: fetch-job-status
#         resource: huaweicloud.ecs
#         actions:
#               - type: fetch-job-status
#                 job_id: "ff8080829585a76f0195c6f36db51bc5"

# policies:
#       - name: stop-ecs-server
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-stop
#                 mode: "SOFT"

# policies:
#       - name: start-ecs-server
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 op: in
#                 value: [ "bac642b0-a9ca-4a13-b6b9-9e41b35905b6", "c8bc054f-8a56-4223-a0b1-937ed69ef7fc" ]
#         actions:
#               - type: instance-start

# policies:
#       - name: start-ecs-server
#         resource: huaweicloud.ecs
#         query:
#               - status: SHUTOFF
#         actions:
#               - type: instance-start

# policies:
#       - name: reboot-ecs-server
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-reboot
#                 mode: "SOFT"

# policies:
#       - name: terminate-ecs-server
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - instance-terminate

# policies:
#       - name: add-security-groups
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-add-security-groups
#                 name: sg-default-smb

# policies:
#       - name: delete-security-groups
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-delete-security-groups
#                 name: sg-default-smb

# policies:
#       - name: resize
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-resize
#                 flavor_ref: "x1.1u.1g"
#                 mode: "withStopServer"

# policies:
#       - name: set-instance-profile
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: set-instance-profile
#                 metadata:
#                         key: value

# policies:
#       - name: instance-create-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: tag
#                 tags:
#                         maid_offhours: off=(M-F,19)

# policies:
#       - name: instance-rename-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: rename-tag
#                 old_key: AAAA
#                 new_key: BBBB

# policies:
#       - name: instance-trim-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: tag-trim
#                 space: 3
#                 preserve:
#                       - owner1

# policies:
#       - name: instance-normalize-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: normalize-tag
#                 key: AAAA
#                 action: upper

# policies:
#       - name: instance-normalize-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: untag
#                 tags:
#                       - AAAA

# policies:
#       - name: multiple-tags-example
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: mark-for-op
#                 tag: tag-stop-instance
#                 op: instance-stop
#                 hours: 4

# policies:
#       - name: instance-count-tag
#         resource: huaweicloud.ecs
#         filters:
#               - type: tag-count
#                 op: gt
#                 count: 0
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"

# policies:
#       - name: instance-whole-image
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-whole-image
#                 name: "whole_image"
#                 vault_id: "c789a0e1-9207-46c7-b539-39dac13bce51"
#                 instance_id: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"

# policies:
#       - name: instance-snapshot
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: id
#                 value: "bac642b0-a9ca-4a13-b6b9-9e41b35905b6"
#         actions:
#               - type: instance-snapshot
#                 incremental: false
#                 vault_id: "c789a0e1-9207-46c7-b539-39dac13bce51"

#########################################################################

# policies:
#       - name: ecs-instances-age
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-age
#                 op: ge
#                 days: 3

# policies:
#       - name: ecs-instances-uptime
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-uptime
#                 op: greater-than
#                 days: 1

policies:
      - name: instance-image-age
        resource: huaweicloud.ecs
        filters:
              - type: instance-image-age
                op: ge
                days: 1

# policies:
#       - name: instance-image
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-image

# policies:
#       - name: ephemeral
#         resource: huaweicloud.ecs
#         filters:
#               - type: ephemeral

# policies:
#       - name: instance-attribute
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-attribute
#                 attribute: OS-EXT-SRV-ATTR:user_data
#                 key: "Value"
#                 op: regex
#                 value: (?smi).*user=

# policies:
#       - name: instance-user-data
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-user-data
#                 op: regex
#                 value: (?smi).*user=

# policies:
#       - name: instance-evs
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-evs

# policies:
#       - name: instance-evs
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-evs
#                 key: encrypted
#                 op: eq
#                 value: false

# policies:
#       - name: instance-vpc
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-vpc

# ECS_07 实例volumes修正：筛选出所有实例中volumes不合规的实例：删除实例时，volumes不会随实例销毁
# policies:
#       - name: instance-volumes-corrections
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-volumes-not-compliance
#         actions:
#               - type: instance-volumes-corrections

# ECS_02 过滤出所有不符合镜像列表的实例
# policies:
#       - name: instance-image-not-compliance
#         resource: huaweicloud.ecs
#         filters:
#               - type: instance-image-not-compliance
#                 image_ids: [ '51a76dc4-0a0c-4e7c-bb01-d9dbaabe1441' ]

#----------------最佳实践-------------------#

# 对所有处于active状态，且更新时间小于2025-03-24T18:20:00Z的实例进行关机操作（除开发机实例）
# policies:
#       - name: instance-list
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: "id"
#                 op: not-in
#                 value: [ "221c294a-cff3-444f-8bec-24566e24b89f", "c8bc054f-8a56-4223-a0b1-937ed69ef7fc", b834c375-7231-482e-a87b-3fba804435b4 ]
#               - type: value
#                 key: "status"
#                 op: eq
#                 value: "ACTIVE"
#               - type: value
#                 key: "updated"
#                 op: lt
#                 value: "2025-03-24T18:00:00Z"
#         actions:
#               - instance-stop

# 对所有没有配置key pair的实例进行开机操作（除开发机实例）
# policies:
#       - name: instance-list
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: "id"
#                 op: not-in
#                 value: [ "221c294a-cff3-444f-8bec-24566e24b89f", "c8bc054f-8a56-4223-a0b1-937ed69ef7fc", b834c375-7231-482e-a87b-3fba804435b4 ]
#               - type: value
#                 key: "key_name"
#                 op: eq
#                 value: null
#         actions:
#               - instance-start

# 对所开通了公网ip的机器进行关机操作（除开发机实例）
# policies:
#       - name: instance-list
#         resource: huaweicloud.ecs
#         filters:
#               - type: value
#                 key: "id"
#                 op: not-in
#                 value: [ "221c294a-cff3-444f-8bec-24566e24b89f", "c8bc054f-8a56-4223-a0b1-937ed69ef7fc", b834c375-7231-482e-a87b-3fba804435b4 ]
#               - type: value
#                 key: addresses.*[]."OS-EXT-IPS:type"
#                 op: contains
#                 value: floating
#         actions:
#               - instance-stop

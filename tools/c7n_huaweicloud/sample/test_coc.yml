policies:
  - name: non-compliant-patch
    resource: huaweicloud.coc
    filters:
      - type: value
        key: count
        value: 1
        op: gte
      - type: missing
        instance_compliant:
          filters:
            - type: value
              key: "equal(instance_compliant[].status. 'non_compliant')"
              value: true
              op: eq
            - type: value
              key: "equal(instance_compliant[].report_scene. 'ECS')"
              value: true
              op: eq
            - type: value
              key: "equal(instance_compliant[].operating_system. 'CentOS')"
              value: true
              op: eq
            - type: value
              key: "equal(instance_compliant[].region. 'ap-southeast-1')"
              value: true
              op: eq
    actions:
      - type: non_compliant_alarm
        smn: true
        region_id: 'cn-north-4'
        topic_urn: 'urn:smn:cn-north-4:ce8476c174f94c6991ea7885e3380d99:custodian_test'
        subject: 'Machine Non-compliant Patch Version Alert'
        message: 'There are machines with non-compliant patch versions installed under your account:'